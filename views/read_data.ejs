
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title> Read Data</title>
    <link rel="stylesheet" href="./index.css">
    <link rel="stylesheet" href="./read.css">
    <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined:opsz,wght,FILL,GRAD@20..48,100..700,0..1,-50..200" />
</head>
<body>
    
    <div class="header">
            
    </div>
    <div class="operation">
        <a href="/index"><button id="insert">Insert Data</button></a>
        <a href="/read_data"><button id="read">Fetch Data</button></a>
        <a href="/update"><button id="update">Update Data</button></a>
        <!-- <a href="/delete"><button id="delete">Delete Data</button></a> -->
    </div>
    <div class="container1"><br><br>
        <div class="search"> 
            <form action="/read_data" method="get" id="search">
            <input type="text" id="searchBody"/>
            <button type="submit" id="submitForm">Search</button></form>
        </div><br><br><br>
        <div id="errorBox" style="text-align: center;font-size: 18px;"></div>
        <br>
        <table id="dataTable" border="1px">
            <thead>
                     <tr>
                     <td width="3%">No.</td>
                     <td width="3%">Id</td>
                     <td width="10%">Product Name</td>
                     <td width="10%">Product Type</td>
                     <td width="6%">Price</td>
                     <td width="5%">Action</td>
                     </tr>
            </thead>
            <tbody id="tbody">
            
        </tbody>
        </table>         
        <br><br>
       

    </div>
</body>
<script>
   
    const readData = document.querySelector('#search');
    readData.addEventListener('submit',(e)=>{
        let obj = {
            name : document.getElementById('searchBody').value
        }
        e.preventDefault();
    
        fetch('/read_data',{
            method:'POST',
            headers : {
                'Content-type': 'application/json',
            },
            body: JSON.stringify(obj),
        }).then((response)=>{
            console.log("response ",response)
            return response.json();
        })
        .then((json)=>{
            tbody.innerHTML = '';
            if(json.length >= 0 ){
                let number = 1;
                for(var i in json){
                document.querySelector('#tbody').innerHTML +=  `<tr>
                    <td>${number}</td>
                    <td>${json[i]._id}</td>
                    <td>${json[i].item}</td>
                    <td>${json[i].type}</td>
                    <td>${json[i].price}</td>
                    <td>
                        <span id="delete-btn" class="material-symbols-outlined" onClick="deleteData('${json[i]._id}')">delete</span>
                    </td>
                    </tr>`;
                    number++;
                 }
            }
        })      
    })
    var delete_btn = document.querySelector('#delete-btn');
    function deleteData(id){
        fetch(`/deleteData?id=${id}`,{
            method : 'DELETE',
            headers :{
            'Content-Type': 'application/json'
        }
        }).then((response)=>{
            alert('data deleted . Refresh Page to see changes');
        })
    }
    
</script>

</html>